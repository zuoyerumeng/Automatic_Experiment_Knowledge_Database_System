HUAWEI1MRS服务申请1.1 实验背景大数据是人类进入互联网时代以来面临的一个巨大问题：社会生产生活产生的数据量越来越大，数据种类越来越多，数据产生的速度越来越快。传统的数据处理技术，比如说单机存储，关系数据库已经无法解决这些新的大数据问题。为解决以上大数据处理问题，Apache 基金会推出了 Hadoop 大数据处理的开源解决方案。Hadoop是一个开源分布式计算平台，可以充分利用集群的计算和存储能力，完成海量数据的处理。企业自行部署Hadoop系统有成本高，周期长，难运维和不灵活等问题。针对上述问题，华为云提供了大数据MapReduce 服务（MRS），MRS是一个在华为云上部署和管理 Hadoop 系统的服务，一键即可部署 Hadoop集群。MRS 提供租户完全可控的一站式企业级大数据集群云服务，完全兼容开源接口，结合华为云计算、存储优势及大数据行业经验，为客户提供高性能、低成本、灵活易用的全栈大数据平台，轻松运行Hadoop、Spark、HBase、Kafka、Storm 等大数据组件，并具备在后续根据业务需要进行定制开发的能力，帮助企业快速构建海量数据信息处理系统，并通过对海量信息数据实时与非实时的分析挖掘，发现全新价值点和企业商机。MRS 服务亮点:MRS基于鲲鹏处理器进行软硬件垂直优化，充分释放硬件算力，实现高性价比。MRS支持华为自研鲲鹏服务器，充分利用鲲鹏多核高并发能力，提供芯片级的全栈自主优化能力，使用华为自研的操作系统EulerOS、华为JDK及数据加速层，充分释放硬件算力，为大数据计算提供高算力输出。在性能相当情况下，端到端的大数据解决方案成本下降30%。
HUAWEI1.2 实验目的掌握MRS 服务的申请与使用。



1.3 实验内容1.3.1 开通 MapReduce 服务步骤 1 登录华为云网站，在El 企业智能中找到 MapReduce 服务华为云HUAWE开年》关于华为云最新活动产品v解决方案EI企业智能^搜索EI企业智能查看所有EI产品>推荐大数据计算MapReduce服务Al服务实时流计算服务CS大数据数据湖探索DLI数据仓库服务DWS表格存储服务CloudTable数据可视化数据可视化DLV图1-1步骤2点击“立即购买，进入购买集群页面按照如下信息配置集群基本信息：选择自定义购买！！
HUAWEI当前区域一选择区域，选择“华东-上海二”（本实验手册以上海二演示，其他区鲲鹏计算可能存在没有资源可用的情况）。集群名称一自定义名称，本实验手册以“mrs-hcia”为例。集群名称不允许相同，读者可自行命名，只能由字母、数字、中划线和下划线组成，并且长度为 1～64 个字符。集群版本-一默认值为当前最新版本，本实验手册以”MRS2.1.0”为例。集群类型一选择混合集群。MRS支持创建混合集群，您可以在同一集群中同时部署分析和流式组件，相比原来的只支持创建独立的分析集群和流式集群，节省管理节点成本的同时可以大大减少不同集群的通信成本，适用于同时需要做离线数据分析和流处理任务的场景。组件选择一勾选分析组件和流式组件里除 Presto、Impala、Kudu 外所有的组件（这三个组件目前还不能使用鲲鹏计算）。外部数据源一不开启。＊集群名称②mrs_hcia＊集群版本MRS 2.1.0＊集群类型分析集群流式集群混合集群必选组件默认勾选自动勾选。分析组件口　组件名版本描述Presto308一种开源、分布式SQL查询引擎。doopeH3.1.1针对大数据集的分布式数据处理框架 Spark2.3.2快速、通用的大数据处理引擎HBase 2.1.1 可扩展、分布式数据库，支持存储结构化数据Hive3.1.0提供数据汇聚和即席查询的数据仓库Hue3.11.0提供hadoopUl能力，让用户通过浏览器分析处理Hadoop集群数.Loader2.0.0Loader是基于开源Sqoop 1.99.7开发，专为Apache Hadoop和结.Tez0.9.1一个支持有向无环图的分布式计算框架Flink1.7.0 个分布式大数据处理引擎，可对有限数据流和无限数据流进行.Impala3.2.0种处理大量数据的SQL查询引擎。 Kudu1.9.0一种列存储管理器。图1-2 
HUAWEIImpala3.2.0一种处理大量数据的SQL查询引擎。Kudu1.9.0一种列存储管理器。流式组件组件名版本描述 Kafka1.1.0分布式消息发布订阅系统 Storm1.2.1分布式实时计算系统 Flume1.6.0个分布式、高可用、高可靠的海量日志采集、聚合和传输系统.使用外部数据源存储元数据O图1-3Kerberos 认证一选择不开启认证。“Kerberos 认证”关闭时，用户可使用MRS 集群的所有功能，建议单用户场景下使用；“Kerberos 认证”开启时，普通用户无权限使用MRS集群的“文件管理”和“作业管理”功能，并且无法查看Hadoop、Spark 的作业记录以及集群资源使用情况。如果需要使用集群更多功能，需要找MRS Manager 的管理员分配权限。建议在多用户场景下使用。用户名一默认为 admin 用户。此用户为 MRS Manager 管理页面登录的用户密码-一读者自行设置。确认密码一一再次输入密码。*Kerberos认证 用户名admin大密码该密码用于登录集群管理页面。大确认密码图1-4计费模式一按需计费
HUAWEI可用分区一默认。可用区域是使用独立电源和网络资源的物理区域虚拟私有云一点击”查看虚拟私有云”按钮，进入网络控制台，点击“创建虚拟私有云”，所有参数默认，点击“立即创建”即可。回到购买集群页面，点击刷新按钮，即可选中创建的虚拟私有云。子网一虚拟私有云创建好后子网自动创建并选中。安全组一默认选择自动创建安全组。弹性公网IP一点击“管理弹性IP”，进入gongwanglP页面，点击“购买弹性IP”按钮，选择按需计费，线路选择“静态BGP”，购买量3个，其它参数默认，点击“立即购买”，完成后回到MRS 页面。点击刷新图标，选择一个IP 绑定:网络配置大可用区 可用区2可用区3可用区1可用区4＊虚拟私有云② default_vpcC查看虚拟私有云＊子网default_ subnet(192.16...C＊安全组 ②自动创建C管理安全组＊弹性公网IP③116.63.62.38C管理弹性公网IF图1-5实例配置：集群高可用一默认是开启，选择不开启集群节点一Master类型的实例规格默认是 4核 8GB;分析 Core 类型的实例规格默认是 4核 16GB，实例数量改为 1，其它默认不变。流式 Core 类型的实例规格默认是 4核16GB，实例数量改为1，其它默认不变。
HUAWEI实例＊集群节点节点类型计费模式实例规格实例数量操作通用计算型4核18 GBI s3.xlarge.2Master ?按需计费系统盘修改 1集群高可用○一普通IO 40 GB × 1数据盘普通IO 200 GB × 1通用计算增强型4 核116 GB I c3.xlarge.4分析Core 按需计费系统盘修改--+普通IO 40 GB × 1数据盘普通IO 100 GB × 1通用计算增强型4 核 116 GB I c3.xlarge.4流式Core ①按需计费系统盘修改+磁盘LVM管理○一普通IO 40 GB × 1数据盘普通0 100 GB × 1分析Task ①按需计费流式Task @按需计费①配置图1-6登录方式一默认选择密码登录的方式用户名一默认root，该用户是登录大数据平台服务器ECS 的账号。密码一读者自行设置。确认密码一再次输入密码。＊登录方式密码密钥对用户名root＊密码该密码用于远程登录ECS机器。大确认密码图1-7点击下一步，进入高级配置。高级配置一所有参数都选择默认
HUAWEI标签如果您需要使用同一标签标识多种云资源，，即所有服务均可在标签输入框下拉选择同一标签，建议在TMS中创建预定义标签。查看预定义标签标签键标签值你还可以添加10个标签。弹性伸缩②添加 请先返回上一步设置Task节点规格后再设置弹性伸缩策略。节点类型节点默认范围资源计划弹性伸缩规则数量操作暂无策略引导操作 名称执行节点执行时机操作暂无引导操作托 ?暂不绑定C 新建托更多√指标共享数据盘加密指标共享 ?数据盘加密③图1-8确认配置参数无误后点击”立即购买”。步骤3 启动完成集群创建需要10分钟左右完成现有集群②MRS集群列表·现有集群集群ID节点数状态历史集群mrs_hcia78374011-9d26-4a31-8b98-ebbabf86670f3运行中操作日志帮助图1-9
HUAWEI



1.3.2弹性服务器绑定公网IP步骤 1 申请弹性 IP点击集群名称，进入集群列表页，点击节点类型为“Master1”的服务器名称，进入弹性云服务器的控制台弹性云服务器> 78374011-9d26-4a31-8b98-ebbabf86670f_node_master1HAbL云服务器控制台名称78374011-9d26-4a31-8b98-ebbabf86670f_node_master1HAbL 总览状态运行中弹性云服务器IDd4f4f23d-d470-4841-b8b1-17fb2f2ca9d0专属主机磁盘2个云服务器备份可用区可用区2 裸金属服务器计费模式按需计费云硬盘委托LogCollection ③新建委托专属分布式存储云服务器组78374011-9d26-4a31-8b98-ebbabf86670f_xPCqSj云硬盘备份镜像服务云硬盘网卡安全组弹性公网IP监控 标签弹性伸缩部分磁盘需要重启才能生效，如果在弹性云服务器内找不到已挂载的磁盘，请重启弹性云服务器。密钥对挂载磁盘您还可以挂载22块VBD磁盘或58块SCSI磁盘云服务器组78374011-9d26-4a31-8b98-ebbabf86670f_node_master1HAbL1系统盘|40GE弹性负载均衡弹性公网IP78374011-9d26-4a31-8b98-ebbabf86670f_node_master1HAb-volume-0001 I数据盘1200GB安全组图1-10步骤 2购买弹性公网 IP如果在购买集群时已经买过弹性IP，直接跳到步骤3。点击“弹性公网IP”选项，再点击“查看弹性公网IP”，会自动跳转到购买页面。云硬盘网卡安全组弹性公网IP监控标签绑定弹性公网IP查看弹性公网IP图1-11点击”购买弹性公网IP”，进入配置页面，按照如下信息配置基本信息：
HUAWEI计费模式一选择按需计费区域一默认区域，确保和购买集群时所选择的区域保持一致。类型一静态 BGP。带宽类型一独享。计费方式一按带宽计费带宽大小一默认值带宽名称一默认值标签一默认不设置购买数量一3个，本手册实验总共需要用到3个弹性IP。点击”立即购买”，确认信息后，点击“提交”，回到弹性云服务器的管理控制台页面。步骤3 绑定IP点击“绑定弹性公网IP”，网卡默认，勾选选择一个IP，点击“确定”。绑定弹性公网IP云服务器名称d3d7d5f1-7c60-418c-83c1-968cc7c53d1c_node_master1duzY选择网卡NIC1(192.168.0.54)(主网卡)选择弹性公网IP查看弹性公网IP请输入弹性公网IPQC弹性公网IP状态　带宽名称带宽大小114.116.103.175②未绑定 5 Mbit/s0bandwidth-bbfc114.116.84.55②未绑定Bandwidth_2019-.. 5 Mbit/s114.115.255.0②未绑定OBandwidth_2019-..5 Mbit/s确定取消图1-12刷新页面，可以看到服务器已成功绑定一个弹性公网IP。
HUAWEI云硬盘网卡安全组弹性公网IP监控标签绑定弹性公网IP查看弹性公网IP114.116.103.1751192.168.0.54弹性公网IP114.116.103.175 流量详情ID3408e54c-0848-464a-a386-60f26962dbef状态?绑定已绑定私有IP 192.168.0.54订单详情带宽类型独享图1-13步骤4设置集群安全组选择安全组，展开页面，点击“更改安全组规则”：260271e5-d303-4151-b6l1-d5305dac89c3_node_master1Hacu远程登录更多基本信息安全弹性公网IP更改安全组NIC1: 121 6.0.6出方向规则方向规则 1更改安全组规见类型协议满口范围/CMP类型远饼Any入方间IPv4yAy入方向IPv4AryAry198.19.32.0/19入方向IPv492.168.0.181/329022100.125.20.57/32TCPIPv4 TCP902IPv4TCP IPv4TCP入方向IPV4Ary图1-14选择入方向规则，点击”添加规则”，选择基本协议一全部放通，点击确定完成配置。
HUAWEI添加入方向规则教我设置①安全组入方向规则为白名单（允许），放通入方向网络流量。安全组mrs_mrs_hcia_EkJj如您要添加多条规则，建议请单击导入规则以进行批量导入协议端口②源地址①描述操作全部放通IP地址全部放通0.0.0.070常用协议端口全部TCP全部UDF可以创建4,966个安全组规则，如需申请更多配额请点击申请扩大配额。自定义TCP自定义UDP确定取消ICMP图1-15集群安全组设置完成。步骤 5 配置 MRS Manager 安全组进入MRS集群列表页，点击集群名称，进入概览页面，点击“添加安全组规则”：mrs_hcia< 返回朱群列表概览节点管理告警管理补丁管理文件管理作业管理标签管理基本信息了解更多名称mrs- hcia生群I弹性公网16.63.62.38添加安全组规则运行中创建时问集群状态2020/04/06 13:51:58 GMT+08:0Kerberos认证集群管理页面①点击看可用区可用区2日志记录开启寸费类型按需计费子网 default subnet集群版本MRS 2.1.0虚拟私有云default_vpc安全组[ss生群关型混台集群托～①新建委托IAM用户同步 ① 〇未同步数据连接点击管理图1-16勾选确认，点击确定按钮：+添加安全组规则＊添加安全组规则③180.97.206.19管理安全组规则我确认这里设置的授权对象是可信任的公网访问IP范围，禁止使用0.0.0.0/0,否则会有安全风险。教我设置确定取消图1-17Manager 安全组设置完成。
HUAWEI



1.3.3Putty登录弹性云服务器步骤 1 下载 Putty 工具访问网址：https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html, 选择 putty.exe 下载Alternative binary filesThe installer packages above will provide versions of all of these (except PuTTYtel),(Not sure whether you want the 32-bit or the 64-bit version? Read the FAQ entry.)putty. exe (the SSH and Telnet client itself)32-bit:putty. exe(or by FTP)(signature)64-bit:putty. exe(or by FTP)(signature) pscp. exe (an ScP client, i.e. command-line secure file copy)32-bit:pscp. exe(or by FTP)(signature)64-bit:pscp. exe(or by FTP)(signature) psftp. exe (an SFTP client, i.e. general file transfer sessions much like FTP)32-bit:psftp. exe(or by FTP)(signature)64-bit:psftp. exe(or by FTP).(signature) puttytel. exe (a Telnet-only client)32-bit:puttytel. exe(or by FTP)(signature)64-bit:puttytel. exe(or by FTP)(signature)图1-18步骤2 进入目录，执行安装并登陆双击exe文件安装软件，安装完成后打开软件，如图：
HUAWEI PuTTY ConfigurationCateqory: SessionBasic options for your PuTTY sessionI... LoggingSpecify the destination you want to connect to TeminalHost Name (or IP address)Port.Keyboard... ell22... FeaturesConnection type:- WindowO Raw OIelnet O Rlogin O SSHO Sejial. Appearance.. BehaviourLoad, save or delete a stored session TranslationSaved Sessions. Selection- Connectionpeoj Data192.168.52.155SaveI.. Proxy192.168.52.156.. TelnetDeleteI. Rlogin由 SSH..Serial.Close window on exit:O AlwaysO NeverO Only on clean exitOpenAbout图1-19在 Host Name 栏中输入 Master 节点绑定的弹性 IP 值，点击 Open 按钮，弹出框点击“是”，输入用户名 root 和密码即可登录到 Master节点服务器： root@node-master1HaCu:~Xogin as: root08:00:10 1970BteriHacu图1-20步骤 3 测试集群
HUAWEI输入命令：source /opt/client/bigdata_env ，设置环境变量再输入命令：hdfs dfs -ls /，查看 HDFS 文件系统[root@node-masterlduzY ~]# source /opt/client/bigdata_env[root@node-masterlduzY ～]# hdfs dfs-lsFound 26 itemsdrwxr-xr-xroot root4096 2019-02-23 18:38 /CloudResetPwdUpdateAgentdrwxr-xr-xroot root4096 2019-02-23 18:38 /cloudrResetPwdAgent-rwxr-xr-xroot root0 2019-02-23 18:24 /0TC_Euler0S_2.x86_64-0.9.1-20170904-0513rwxrrootroot3822 2019-02-23 18:24 /READMEdr-xr-xr-x24576 2019-02-23 18:34 /binrootrootroot root3000 2019-03-25 10:54 /devdrwxr-xr-xroot root4096 2019-03-25 11:08 /etcdrwxr-xr-xroot root4096 22019-03-25 11:08 //home- rw-0 2019-03-25 10:55 //install_os_optimization.logdr-xr-xr-xroot root4096 2019-02-23 18:30 /libIdr-xr-xr-xroot root36864 2019-02-23 18:38 /lib64测试完毕，集群可以正常使用。



1.3实验内容

1.3.4使用Winscp可以在Window和Linux服务器之间传输文件。步骤 1 下载 Winscp下载 Winscp，打开网址：https://winscp.net/eng/download.php 下载软件，安装完成后打开软件： WinSCP本地(L) 标记(M) 文件(F) 命令(C) 会话(S) 选项(O) 远程(R) 帮助(H)婷醇队列、传输选项默认新建会话我的文档上传编辑×属性 新建登录C:\User(Documents)新建站点会话名字文件协议()SFTP ABCPhoto主机名() Apowersoft端口号(R)h bokecc22 台 Camtasia Studio用户名U密码(E) Fiddler2 Navicat 保存()..高级(A... NetSarang OneNote 笔记本 WeChat Files. Zoom留我的形状我接收到的文件 自定义 Office 模板 LotuslnstallogI具管理(帮助 pgadmin.log在启动与最后会话被关闭时显示登录对话框(S)
HUAWEI图1-21步骤 2 连接服务器在登录界面，填入申请的弹性 IP、端口号默认22、用户名、密码,点击登录，弹出框选择“Yes”，登陆成功登录口回新建站点会话文件协议(日)SFTP主机名()端口号(R)116.63.53.8322 周用户名(U)密码()root保存()..高级(..工具()管理(M)固登录关闭帮助在启动与最后会话被关闭时显示登录对话框()图1-22左边是 Windos 的文件目录，右边是远程服务器 Linux 的文件目录
HUAWEI root - Master - WinsCP本地[L) 标记(M) 文件(F) 命令[C) 会话[S) 选项(O) 远程(B) 帮助(上[静队列、我的文档国下载编错属性新建田日/root/名享大小类型名字大小已改变权限2020/4/6 13:19:5: ABCPhotooenvfile1 KB2019/11/13 20:19:59 ApowersoftI bokeco Camtasia Studio Fiddler2I Wechat Files我的形状我接收到的文件 自定义 Ofice 模板135 KB  pgad min.og图1-23后续的实验过程中，会用到 Putty 和Winscp。



1.3.5访问集群的管理页面步骤 1 打开控制台在华为云 MRS 服务的控制台页面，单击集群名称“mrs-hcia”进入集群详情页面。华为云。北京控制台服务列表 √收藏IUAWE现有集群③MRS您还剩余497台弹性云服务器、13个云服务器组、3,988核vCPU、7,97集群列表·现有集群名称集群ID·历史集群mrs_hciad3d7d5f1-7c60-418c-83c1-968cc7c5..操作日志帮助图1-24
HUAWEI步骤2点击”点击查看”按钮mrs_hcia《返回集群列表概览节点管理告警管理补丁管理文件管理作业管理标签管理基本信息了解更多名称mrs_hcia集群ID260271e5-d303-4151-b6f1-d5305dac89c3集群状态运行中创建时间2020/04/06 13:51:58 GMT+08:00集群管理页面②点击查看可用区可用区2付费类型按需计费子网 default subnet集群版本MRS 2.1.0虚拟私有云 default_vpc集群类型混合集群要托～②新建委托IAM用户同步 ②未同步数据连接②点击管理图1-25在弹出框中选择弹性IP（如果没有弹性IP，需要去购买），勾选确认框，点击”确定”。访问MRS Manager页面访问MRSManager页面需绑定弹性公网IP以及添加安全组规则。了解更多弹性公网IP?116.63.62.38管理弹性公网IPC添加安全组规则③180.97.206.22/32管理安全组规则我确认180.97.206.22为可信任的公网访问IP，并允许从该IP访问MRS Manager页面。确定取消图1-26选择高级，点击继续前往
HUAWEIA您的连接不是私密连接攻击者可能会试图从116.63.62.38窃取您的信息（例如：密码、通讯内容或信用卡信息）。了解详情NET:ERR_CERT_AUTHORITY _INVALID口 将您访问的部分网页的网址、有限的系统信息以及部分网页内容发送给 Google，以帮助我们提升Chrome 的安全性。隐私权政策高级返回安全连接图1-27步骤3输入用户名及密码在弹出页面中输入用户名：admin及密码（密码是在申请集群时设置）用户登录adminMRSManager■记住登录名图1-28点击“登录”，即可进入MRS Manager页面。
HUAWEI | MRS Manager系统概览服务管理主机管理告警管理审计管理租户管理系统设置时间区间实时查看『导出服务概览集群主机健康状态统计服务→健度状志角色数良好DBServiceDBServer 1FlumeFlume: 1 MonitorServer: HBase○良好RegionServer: 1ThriftServ.HDFS①良好Zkfc: 1DataNode: 1Jour集群磁盘写速率统计集群磁盘占用率统计2.051MB/单位： %9.659.559.459.49.353/25 16:4503/25 17:0003/25 17:1503/25 16:3003/25 16:4503/25 17:0003/25 17:15图1-291.4实验小结本实验主要讲述华为云大数据集群服务的申请与访问，通过本实验学员学会申请MRS 服务，并登录集群，为后续实验打下基础。
